<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Six Seven</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            touch-action: none;
            overflow: hidden;
            background-color: #111;
        }

        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff00de, 0 0 30px #ff00de, 0 0 40px #ff00de;
        }

        .neon-border {
            box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff00de, 0 0 30px #ff00de;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes fingerGuns {
            0% { transform: scale(1) rotate(0deg); }
            20% { transform: scale(1.1) rotate(-5deg); }
            40% { transform: scale(1.1) rotate(5deg); }
            60% { transform: scale(1.1) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-finger-guns { animation: fingerGuns 0.6s ease-in-out; }
        .animate-shake { animation: shake 0.5s; }
        .animate-pop { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .ui-layer {
            position: absolute;
            z-index: 20;
            pointer-events: none; /* Let clicks pass through to canvas mostly */
        }

        .interactive-ui {
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen w-screen flex justify-center overflow-hidden">

    <!-- Mobile Container -->
    <div id="game-container" class="relative w-full max-w-md h-full bg-slate-900 shadow-2xl overflow-hidden flex flex-col">

        <!-- Canvas for Game World -->
        <canvas id="game-canvas"></canvas>

        <!-- UI Overlay: Top Bar -->
        <div class="ui-layer top-0 left-0 w-full p-4 flex justify-between items-start">
            <div class="flex flex-col">
                <div class="text-xs uppercase tracking-widest text-cyan-400 font-bold mb-1">Score</div>
                <div id="score-display" class="text-3xl font-bold text-white leading-none">0</div>
            </div>

            <div class="flex flex-col items-center">
                 <div class="text-xs uppercase tracking-widest text-pink-500 font-bold mb-1">Time</div>
                 <div id="timer-display" class="text-2xl font-bold text-white leading-none">60</div>
            </div>

            <div class="flex flex-col items-end">
                <div class="text-xs uppercase tracking-widest text-yellow-400 font-bold mb-1">Streak</div>
                <div id="streak-display" class="text-3xl font-bold text-yellow-300 leading-none">x1</div>
            </div>
        </div>

        <!-- Rizzler Character Area (Middle/Bottom) -->
        <div class="ui-layer bottom-32 w-full flex justify-center pointer-events-none">
             <!-- The Rizzler SVG -->
             <div id="rizzler-avatar" class="w-48 h-48 animate-float transition-transform duration-200">
                <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Glow -->
                    <circle cx="100" cy="100" r="80" fill="#a855f7" fill-opacity="0.2" class="animate-pulse" />

                    <!-- Head -->
                    <rect x="60" y="50" width="80" height="90" rx="20" fill="#FFD1DC" stroke="#333" stroke-width="3"/>

                    <!-- Hair -->
                    <path d="M55 60 C55 30 70 20 100 20 C130 20 145 30 145 60" fill="#333" />
                    <path d="M100 20 L110 35 L120 15" stroke="#333" stroke-width="3" fill="none"/>

                    <!-- Sunglasses (The defining feature) -->
                    <g id="sunglasses" class="transition-transform duration-300 origin-center">
                        <rect x="65" y="80" width="32" height="20" rx="5" fill="#111" />
                        <rect x="103" y="80" width="32" height="20" rx="5" fill="#111" />
                        <line x1="97" y1="90" x2="103" y2="90" stroke="#111" stroke-width="3" />
                        <line x1="55" y1="85" x2="65" y2="85" stroke="#111" stroke-width="3" />
                        <line x1="135" y1="85" x2="145" y2="85" stroke="#111" stroke-width="3" />
                        <!-- Reflection -->
                        <path d="M68 82 L80 82 L75 95 Z" fill="rgba(255,255,255,0.2)" />
                        <path d="M106 82 L118 82 L113 95 Z" fill="rgba(255,255,255,0.2)" />
                    </g>

                    <!-- Mouth -->
                    <path id="mouth" d="M90 120 Q100 130 110 120" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" />

                    <!-- Hands (Hidden by default, appear for finger guns) -->
                    <g id="left-hand" transform="translate(40, 140) rotate(-20)" style="opacity: 0;">
                         <path d="M0 0 L20 0 L20 10 L0 10 Z" fill="#FFD1DC" stroke="#333" stroke-width="2"/>
                         <path d="M20 0 L30 -5" stroke="#333" stroke-width="2"/> <!-- Finger -->
                    </g>
                     <g id="right-hand" transform="translate(160, 140) rotate(20) scale(-1, 1)" style="opacity: 0;">
                         <path d="M0 0 L20 0 L20 10 L0 10 Z" fill="#FFD1DC" stroke="#333" stroke-width="2"/>
                         <path d="M20 0 L30 -5" stroke="#333" stroke-width="2"/>
                    </g>
                </svg>
             </div>
        </div>

        <!-- Feedback Text Area -->
        <div class="ui-layer bottom-72 w-full flex justify-center">
            <div id="feedback-text" class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 drop-shadow-lg opacity-0 transform scale-50">
                W RIZZ!
            </div>
        </div>

        <!-- Bottom UI: Meter -->
        <div class="ui-layer bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black to-transparent h-32 flex flex-col justify-end items-center interactive-ui">
            <div class="w-full flex justify-between items-center mb-2 px-2">
                <span class="text-sm font-bold text-gray-400">CHARM METER</span>
                <span class="text-sm font-bold text-cyan-400">TARGET: 6 or 7</span>
            </div>

            <!-- Slots -->
            <div id="meter-slots" class="flex gap-2 justify-center w-full mb-4">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Start/Game Over Overlay -->
        <div id="menu-overlay" class="absolute inset-0 z-50 bg-slate-900/95 flex flex-col items-center justify-center p-6 text-center interactive-ui transition-opacity duration-300">
            <h1 class="text-6xl font-black text-white mb-2 tracking-tighter neon-text">
                <span class="text-cyan-400">SIX</span> <span class="text-pink-500">SEVEN</span>
            </h1>
            <h2 class="text-xl font-bold text-yellow-300 mb-8 italic opacity-80">feat. THE RIZZLER</h2>

            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 w-full mb-6">
                <p class="text-gray-300 mb-2 font-bold">DAILY CHALLENGE</p>
                <p id="daily-challenge-text" class="text-white text-lg">Hit "7" five times in a row!</p>
            </div>

            <div class="space-y-4 w-full">
                <button onclick="startGame()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-full text-xl font-bold shadow-lg transform active:scale-95 transition-all hover:scale-105 hover:shadow-purple-500/50">
                    START RIZZING
                </button>
                <div class="flex justify-center mt-4">
                    <button id="sound-toggle" onclick="toggleSound()" class="text-xs text-gray-500 uppercase font-bold tracking-widest border border-gray-700 px-3 py-1 rounded hover:bg-gray-800 transition-colors">
                        Sound: ON
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-2">
                    Tap numbers to sum exactly 6 or 7.<br>Don't overflow!
                </p>
            </div>
        </div>

    </div>

    <script>
        // --- Game Config & State ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('game-container');

        let gameState = {
            isPlaying: false,
            score: 0,
            streak: 1,
            timeLeft: 60,
            lastTime: 0,
            spawnTimer: 0,
            spawnRate: 1000, // ms
            difficultyMultiplier: 1,
            numbers: [],
            particles: [],
            meter: [], // numbers currently in charm meter
            maxMeterSize: 5,
            soundEnabled: true
        };

        const NUM_COLORS = [
            '#FFFFFF', // 0 unused
            '#4ade80', // 1 - green
            '#22d3ee', // 2 - cyan
            '#f472b6', // 3 - pink
            '#facc15', // 4 - yellow
            '#a78bfa', // 5 - purple
            '#fb7185', // 6 - rose
            '#fb923c', // 7 - orange
            '#94a3b8', // 8 - gray
            '#f87171'  // 9 - red
        ];

        const SLANG_TERMS = [
            "W RIZZ", "UNSPOKEN", "CHEF'S KISS", "SMOOTH", "CHARMED", "SHEESH", "ON LOCK"
        ];

        const BAD_TERMS = [
            "L RIZZ", "BUSTED", "TOO MUCH", "AWKWARD", "CRINGE"
        ];

        // --- Resize Handling ---
        function resize() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- Audio System (Web Audio API) ---
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        const sfx = {
            playTone: (freq, type, duration, vol = 0.1) => {
                if (!gameState.soundEnabled || !audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            },
            tap: () => {
                // High blip
                sfx.playTone(800, 'sine', 0.1, 0.05);
            },
            success: (isSeven) => {
                // Major Chord
                const base = isSeven ? 523.25 : 440.00; // C5 or A4
                const type = 'triangle';
                const vol = 0.1;
                const dur = 0.4;
                sfx.playTone(base, type, dur, vol);
                setTimeout(() => sfx.playTone(base * 1.25, type, dur, vol), 50); // Major 3rd
                setTimeout(() => sfx.playTone(base * 1.5, type, dur, vol), 100); // Perfect 5th
                if(isSeven) setTimeout(() => sfx.playTone(base * 2, type, dur, vol), 150); // Octave
            },
            fail: () => {
                if (!gameState.soundEnabled || !audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        };

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const btn = document.getElementById('sound-toggle');
            btn.innerText = `Sound: ${gameState.soundEnabled ? 'ON' : 'OFF'}`;
            btn.className = `text-xs uppercase font-bold tracking-widest border border-gray-700 px-3 py-1 rounded transition-colors ${gameState.soundEnabled ? 'text-gray-500 hover:bg-gray-800' : 'text-red-500 border-red-900 bg-red-900/20'}`;
        }

        // --- The Rizzler Animation Controller ---
        const rizzlerAvatar = document.getElementById('rizzler-avatar');
        const sunglasses = document.getElementById('sunglasses');
        const mouth = document.getElementById('mouth');
        const leftHand = document.getElementById('left-hand');
        const rightHand = document.getElementById('right-hand');
        const feedbackEl = document.getElementById('feedback-text');

        function setRizzlerState(state) {
            // Reset transforms
            rizzlerAvatar.classList.remove('animate-shake', 'animate-finger-guns');
            sunglasses.style.transform = 'translateY(0)';
            mouth.setAttribute('d', 'M90 120 Q100 130 110 120'); // Smile
            leftHand.style.opacity = '0';
            rightHand.style.opacity = '0';

            if (state === 'cool') {
                rizzlerAvatar.classList.add('animate-finger-guns');
                mouth.setAttribute('d', 'M90 120 Q100 125 110 120'); // Smirk
                // Show hands
                leftHand.style.opacity = '1';
                rightHand.style.opacity = '1';
            } else if (state === 'fail') {
                rizzlerAvatar.classList.add('animate-shake');
                sunglasses.style.transform = 'translateY(5px) rotate(10deg)'; // Glasses slip
                mouth.setAttribute('d', 'M90 130 Q100 120 110 130'); // Frown
            }
        }

        function showFeedback(text, isGood) {
            feedbackEl.innerText = text;
            feedbackEl.className = `text-4xl font-black text-transparent bg-clip-text drop-shadow-lg opacity-0 transform scale-50 transition-all duration-300 absolute`;

            if (isGood) {
                feedbackEl.classList.add('bg-gradient-to-r', 'from-cyan-400', 'to-purple-500');
            } else {
                feedbackEl.classList.add('bg-gradient-to-r', 'from-red-500', 'to-orange-500');
            }

            // Trigger reflow
            void feedbackEl.offsetWidth;

            feedbackEl.style.opacity = '1';
            feedbackEl.style.transform = 'scale(1.2) translateY(-20px)';

            setTimeout(() => {
                feedbackEl.style.opacity = '0';
                feedbackEl.style.transform = 'scale(1.5) translateY(-50px)';
            }, 600);
        }

        // --- Game Logic ---

        class NumberDroplet {
            constructor() {
                this.r = 25;
                this.x = Math.random() * (canvas.width - this.r * 2) + this.r;
                this.y = -50;
                // Weighted random for numbers. We want sums of 6/7 to be possible.
                // 1, 2, 3, 4, 5, 6 are useful. 7 is instant win. 8, 9 are hard.
                const rand = Math.random();
                if (rand < 0.1) this.value = 7; // Rare instant win
                else if (rand < 0.2) this.value = 6;
                else if (rand < 0.4) this.value = 1;
                else this.value = Math.floor(Math.random() * 5) + 1; // 1-5 mostly

                this.speed = (Math.random() * 1.5 + 1.5) * gameState.difficultyMultiplier;
                this.color = NUM_COLORS[this.value] || '#fff';
                this.markedForDeletion = false;
                this.id = Math.random().toString(36).substr(2, 9);
            }

            update(dt) {
                this.y += this.speed; // Frame independent-ish but simplified for now
                if (this.y > canvas.height) {
                    this.markedForDeletion = true;
                    // Penalty for missed opportunities? Maybe just let them go to keep flow.
                    // Let's reset streak if you let a "7" pass? No, too harsh.
                }
            }

            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fillStyle = '#1e293b'; // dark slate bg
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = this.color;
                ctx.stroke();

                ctx.fillStyle = this.color;
                ctx.font = 'bold 24px Fredoka';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.value, this.x, this.y + 2);
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = Math.random() * 4 + 2;
                this.speedX = Math.random() * 6 - 3;
                this.speedY = Math.random() * 6 - 3;
                this.life = 1;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 0.05;
                this.size *= 0.95;
            }
            draw(ctx) {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        function spawnNumber() {
            gameState.numbers.push(new NumberDroplet());
        }

        function createParticles(x, y, color) {
            for(let i=0; i<10; i++) {
                gameState.particles.push(new Particle(x, y, color));
            }
        }

        function updateMeterUI() {
            const container = document.getElementById('meter-slots');
            container.innerHTML = '';

            // Render active slots
            gameState.meter.forEach(num => {
                const el = document.createElement('div');
                el.className = 'w-10 h-10 rounded-full border-2 border-white flex items-center justify-center text-xl font-bold text-white bg-slate-800 animate-pop';
                el.innerText = num;
                el.style.borderColor = NUM_COLORS[num];
                container.appendChild(el);
            });

            // Render empty slots
            for(let i=gameState.meter.length; i<gameState.maxMeterSize; i++) {
                const el = document.createElement('div');
                el.className = 'w-10 h-10 rounded-full border-2 border-slate-700 bg-slate-800/50';
                container.appendChild(el);
            }
        }

        function checkMath(x, y) {
            const sum = gameState.meter.reduce((a, b) => a + b, 0);

            if (sum === 6 || sum === 7) {
                // SUCCESS
                const isSeven = sum === 7;
                const points = isSeven ? 700 : 600;

                gameState.score += points * gameState.streak;
                gameState.streak = Math.min(gameState.streak + 1, 20); // Cap streak
                gameState.timeLeft += 2; // Bonus time
                gameState.meter = []; // Clear meter

                // Visuals & Audio
                sfx.success(isSeven);
                setRizzlerState('cool');
                createParticles(x, y, isSeven ? '#fb923c' : '#fb7185');
                const word = SLANG_TERMS[Math.floor(Math.random() * SLANG_TERMS.length)];
                showFeedback(word, true);

            } else if (sum > 7) {
                // BUST
                sfx.fail();
                gameState.streak = 1;
                gameState.meter = [];
                setRizzlerState('fail');
                showFeedback(BAD_TERMS[Math.floor(Math.random() * BAD_TERMS.length)], false);
                container.classList.add('animate-shake');
                setTimeout(() => container.classList.remove('animate-shake'), 500);
            } else if (gameState.meter.length >= gameState.maxMeterSize) {
                 // FULL WITHOUT MATCH
                sfx.fail();
                gameState.streak = 1;
                gameState.meter = [];
                setRizzlerState('fail');
                showFeedback("FULL!", false);
            }

            updateUI();
            updateMeterUI();
        }

        function updateUI() {
            document.getElementById('score-display').innerText = gameState.score;
            document.getElementById('streak-display').innerText = 'x' + gameState.streak;

            // Color code streak
            const streakEl = document.getElementById('streak-display');
            if(gameState.streak > 10) streakEl.className = 'text-3xl font-bold text-purple-400 leading-none neon-text';
            else if(gameState.streak > 5) streakEl.className = 'text-3xl font-bold text-cyan-400 leading-none';
            else streakEl.className = 'text-3xl font-bold text-yellow-300 leading-none';
        }

        function handleInput(e) {
            if (!gameState.isPlaying) return;

            const rect = canvas.getBoundingClientRect();
            let clickX, clickY;

            if (e.type === 'touchstart') {
                clickX = e.touches[0].clientX - rect.left;
                clickY = e.touches[0].clientY - rect.top;
            } else {
                clickX = e.clientX - rect.left;
                clickY = e.clientY - rect.top;
            }

            // Check collision with numbers
            // Iterate backwards to click top-most first
            for (let i = gameState.numbers.length - 1; i >= 0; i--) {
                const n = gameState.numbers[i];
                const dist = Math.sqrt((clickX - n.x) ** 2 + (clickY - n.y) ** 2);

                if (dist < n.r + 15) { // +15 forgiveness padding
                    // HIT
                    sfx.tap();
                    gameState.meter.push(n.value);
                    createParticles(n.x, n.y, n.color);
                    gameState.numbers.splice(i, 1); // Remove

                    updateMeterUI();
                    checkMath(clickX, clickY); // Check logic

                    e.preventDefault(); // Prevent double firing
                    return;
                }
            }
        }

        // --- Game Loop ---
        function update(timestamp) {
            if (!gameState.isPlaying) return;
            const dt = timestamp - gameState.lastTime;
            gameState.lastTime = timestamp;

            // Timer
            if (timestamp % 1000 < 16) { // Approx every second decrement
                 // This is rough, let's do it properly
            }

            // Clearing Canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Spawner
            gameState.spawnTimer += dt;
            if (gameState.spawnTimer > gameState.spawnRate) {
                spawnNumber();
                gameState.spawnTimer = 0;
                // Slowly increase difficulty
                gameState.spawnRate = Math.max(400, 1000 - (gameState.score / 50));
                gameState.difficultyMultiplier = 1 + (gameState.score / 5000);
            }

            // Update & Draw Numbers
            gameState.numbers.forEach((n, index) => {
                n.update(dt);
                n.draw(ctx);
                if (n.markedForDeletion) gameState.numbers.splice(index, 1);
            });

            // Update & Draw Particles
            gameState.particles.forEach((p, index) => {
                p.update();
                p.draw(ctx);
                if (p.life <= 0) gameState.particles.splice(index, 1);
            });

            requestAnimationFrame(update);
        }

        // Separate timer interval
        let gameInterval;
        function startGameTimer() {
            clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                if (!gameState.isPlaying) return;
                gameState.timeLeft--;
                document.getElementById('timer-display').innerText = gameState.timeLeft;

                if (gameState.timeLeft <= 10) {
                    document.getElementById('timer-display').classList.add('text-red-500', 'animate-pulse');
                } else {
                    document.getElementById('timer-display').classList.remove('text-red-500', 'animate-pulse');
                }

                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function startGame() {
            // Init Audio Context on user gesture
            initAudio();

            // Reset State
            gameState.score = 0;
            gameState.streak = 1;
            gameState.timeLeft = 60;
            gameState.numbers = [];
            gameState.particles = [];
            gameState.meter = [];
            gameState.isPlaying = true;
            gameState.spawnRate = 1000;

            // Random daily challenge text
            const challenges = [
                "Get a 20x Rizz Streak!",
                "Score 10,000 points!",
                "Hit '7' five times in a row!",
                "Clear 50 numbers!"
            ];
            document.getElementById('daily-challenge-text').innerText = challenges[Math.floor(Math.random() * challenges.length)];

            // UI Reset
            document.getElementById('menu-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('menu-overlay').style.display = 'none';
            }, 300);

            updateUI();
            updateMeterUI();
            setRizzlerState('normal');

            gameState.lastTime = performance.now();
            requestAnimationFrame(update);
            startGameTimer();
        }

        function endGame() {
            gameState.isPlaying = false;
            clearInterval(gameInterval);

            // Show Menu
            const menu = document.getElementById('menu-overlay');
            menu.style.display = 'flex';
            setTimeout(() => menu.style.opacity = '1', 10);

            const btn = menu.querySelector('button');
            btn.innerText = "PLAY AGAIN";

            const title = menu.querySelector('h1');
            title.innerHTML = `<span class="text-white text-4xl block mb-2">GAME OVER</span>Score: ${gameState.score}`;
        }

        // --- Event Listeners ---
        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('touchstart', handleInput, {passive: false});

        // Prevent default touch actions on UI to avoid zoom/scroll
        document.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

    </script>
</body>
</html>